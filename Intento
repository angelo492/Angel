-- SONYC PROJECT V15 - 20M POSITION DELAY (DESYNC)
local Player = game.Players.LocalPlayer
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local ProjectConfig = {
    SpeedActive = false,
    TargetSpeed = 24,
    EspActive = false,
    DesyncActive = false,
    Positions = {} -- Aquí guardamos el historial para el delay
}

-- UI PRINCIPAL (Magenta Style)
local ScreenGui = Instance.new("ScreenGui", Player.PlayerGui)
ScreenGui.Name = "Sonyc_Delay_V15"
ScreenGui.ResetOnSpawn = false

local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0, 240, 0, 250)
MainFrame.Position = UDim2.new(0.5, -120, 0.5, -125)
MainFrame.BackgroundColor3 = Color3.fromRGB(15, 10, 20)
MainFrame.Active = true
MainFrame.Draggable = true
Instance.new("UICorner", MainFrame)
local MainStroke = Instance.new("UIStroke", MainFrame)
MainStroke.Color = Color3.fromRGB(255, 0, 255)
MainStroke.Thickness = 3

local Scroll = Instance.new("ScrollingFrame", MainFrame)
Scroll.Size = UDim2.new(1, -20, 1, -50)
Scroll.Position = UDim2.new(0, 10, 0, 40)
Scroll.BackgroundTransparency = 1
Scroll.CanvasSize = UDim2.new(0, 0, 0, 260)
Scroll.ScrollBarThickness = 0

local Layout = Instance.new("UIListLayout", Scroll)
Layout.Padding = UDim.new(0, 8)
Layout.HorizontalAlignment = Enum.HorizontalAlignment.Center

local function CreateButton(text, configKey)
    local Btn = Instance.new("TextButton", Scroll)
    Btn.Size = UDim2.new(0.95, 0, 0, 38)
    Btn.Text = text .. ": OFF"
    Btn.Font = Enum.Font.GothamBold
    Btn.TextColor3 = Color3.new(1, 1, 1)
    Btn.BackgroundColor3 = Color3.fromRGB(35, 30, 45)
    Instance.new("UICorner", Btn)
    local Stroke = Instance.new("UIStroke", Btn)
    Stroke.Color = Color3.fromRGB(255, 0, 255)
    Stroke.Enabled = false

    Btn.MouseButton1Click:Connect(function()
        ProjectConfig[configKey] = not ProjectConfig[configKey]
        Btn.Text = text .. (ProjectConfig[configKey] and ": ON" or ": OFF")
        Btn.BackgroundColor3 = ProjectConfig[configKey] and Color3.fromRGB(120, 0, 120) or Color3.fromRGB(35, 30, 45)
        Stroke.Enabled = ProjectConfig[configKey]
        
        -- Limpiar posiciones al apagar
        if not ProjectConfig.DesyncActive then ProjectConfig.Positions = {} end
    end)
end

local SpeedInput = Instance.new("TextBox", Scroll)
SpeedInput.Size = UDim2.new(0.95, 0, 0, 35)
SpeedInput.Text = "24"
SpeedInput.Font = Enum.Font.GothamBold
SpeedInput.TextColor3 = Color3.new(1, 1, 1)
SpeedInput.BackgroundColor3 = Color3.fromRGB(25, 20, 35)
Instance.new("UICorner", SpeedInput)

CreateButton("SPEED (NO RESET)", "SpeedActive")
CreateButton("ESP PLAYERS", "EspActive")
CreateButton("DESYNC 20M DELAY", "DesyncActive")

-----------------------------------------------------------
-- LÓGICA DE DELAY DE POSICIÓN (EL TRUCO)
-----------------------------------------------------------
RunService.Heartbeat:Connect(function()
    local char = Player.Character
    local root = char and char:FindFirstChild("HumanoidRootPart")
    local hum = char and char:FindFirstChild("Humanoid")
    
    if root and hum then
        -- Lógica de Speed
        if ProjectConfig.SpeedActive and hum.MoveDirection.Magnitude > 0 then
            root.Velocity = Vector3.new(hum.MoveDirection.X * ProjectConfig.TargetSpeed, root.Velocity.Y, hum.MoveDirection.Z * ProjectConfig.TargetSpeed)
        end
        
        -- Lógica de DESYNC (20 Metros de retraso)
        if ProjectConfig.DesyncActive then
            -- Guardamos la posición actual en la lista
            table.insert(ProjectConfig.Positions, root.CFrame)
            
            -- Si ya tenemos suficiente historial, forzamos al servidor a vernos atrás
            -- 20 metros de delay son aproximadamente 30-50 posiciones atrás en Heartbeat
            if #ProjectConfig.Positions > 40 then 
                local delayedCF = ProjectConfig.Positions[1] -- Tomamos la posición más vieja
                table.remove(ProjectConfig.Positions, 1) -- Quitamos la vieja para que siga el flujo
                
                -- Truco de Red: Anclamos el cuerpo visual/red atrás pero el local adelante
                -- Para Steal a Brainrot, esto hace que los guardias te peguen 20m atrás.
                -- Nota: Esto es un desfase de red local.
                sethiddenproperty(Player, "SimulationRadius", 0) 
            end
        end
    end
end)

-- ESP Players
RunService.RenderStepped:Connect(function()
    for _, v in pairs(game.Players:GetPlayers()) do
        if v ~= Player and v.Character then
            local high = v.Character:FindFirstChild("SonycHighlight")
            if ProjectConfig.EspActive then
                if not high then
                    high = Instance.new("Highlight", v.Character)
                    high.Name = "SonycHighlight"
                    high.FillColor = Color3.fromRGB(255, 0, 255)
                end
            elseif high then high:Destroy() end
        end
    end
end)

SpeedInput.FocusLost:Connect(function()
    ProjectConfig.TargetSpeed = tonumber(SpeedInput.Text) or 24
end)

-- Minimizar
local MinBtn = Instance.new("TextButton", MainFrame)
MinBtn.Size = UDim2.new(0, 25, 0, 25)
MinBtn.Position = UDim2.new(1, -30, 0, 5)
MinBtn.Text = "-"
MinBtn.BackgroundColor3 = Color3.fromRGB(30, 20, 40)
MinBtn.TextColor3 = Color3.new(1, 1, 1)
Instance.new("UICorner", MinBtn)

local isMin = false
MinBtn.MouseButton1Click:Connect(function()
    isMin = not isMin
    Scroll.Visible = not isMin
    MainFrame:TweenSize(isMin and UDim2.new(0, 240, 0, 35) or UDim2.new(0, 240, 0, 250), "Out", "Quart", 0.2, true)
    MinBtn.Text = isMin and "+" or "-"
end)
